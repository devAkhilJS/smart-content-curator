<div class="reset-password-container">
  <!-- Reset Password Form -->
  <form [formGroup]="resetForm" (ngSubmit)="submit()" *ngIf="!success && !tokenExpired">
    <div class="header">
      <h2>Create New Password</h2>
      <p class="subtitle">Enter your new password below to complete the reset process.</p>
    </div>
    
    <!-- New Password Field -->
    <div class="form-group">
      <label>New Password</label>
      <div class="password-input-container">
        <input 
          formControlName="newPassword" 
          [type]="showNewPassword ? 'text' : 'password'"
          placeholder="Enter new password (min 6 characters)"
          [class.error]="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched"
        />
        <button 
          type="button" 
          class="password-toggle" 
          (click)="toggleNewPasswordVisibility()"
          [attr.aria-label]="showNewPassword ? 'Hide password' : 'Show password'"
        >
          {{ showNewPassword ? '🙈' : '👁️' }}
        </button>
      </div>
      <div *ngIf="resetForm.get('newPassword')?.invalid && resetForm.get('newPassword')?.touched" class="error-message">
        <span *ngIf="resetForm.get('newPassword')?.errors?.['required']">New password is required</span>
        <span *ngIf="resetForm.get('newPassword')?.errors?.['minlength']">Password must be at least 6 characters</span>
      </div>
    </div>
    
    <!-- Confirm Password Field -->
    <div class="form-group">
      <label>Confirm New Password</label>
      <div class="password-input-container">
        <input 
          formControlName="confirmPassword" 
          [type]="showConfirmPassword ? 'text' : 'password'"
          placeholder="Confirm your new password"
          [class.error]="(resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched) || (resetForm.hasError('passwordMismatch') && resetForm.get('confirmPassword')?.touched)"
        />
        <button 
          type="button" 
          class="password-toggle" 
          (click)="toggleConfirmPasswordVisibility()"
          [attr.aria-label]="showConfirmPassword ? 'Hide password' : 'Show password'"
        >
          {{ showConfirmPassword ? '🙈' : '👁️' }}
        </button>
      </div>
      <div *ngIf="resetForm.get('confirmPassword')?.invalid && resetForm.get('confirmPassword')?.touched" class="error-message">
        <span *ngIf="resetForm.get('confirmPassword')?.errors?.['required']">Please confirm your password</span>
      </div>
      <div *ngIf="resetForm.hasError('passwordMismatch') && resetForm.get('confirmPassword')?.touched" class="error-message">
        Passwords do not match
      </div>
    </div>
    
    <!-- Submit Button -->
    <button type="submit" [disabled]="loading || resetForm.invalid" class="reset-btn">
      <span *ngIf="loading" class="spinner"></span>
      {{ loading ? 'Resetting Password...' : 'Reset Password' }}
    </button>
    
    <!-- Error Display -->
    <div *ngIf="error" class="error">{{ error }}</div>
    
    <!-- Navigation Links -->
    <div class="auth-links">
      <a routerLink="/auth/login">← Back to Login</a>
    </div>
  </form>

  <!-- Success Message -->
  <div *ngIf="success" class="success-container">
    <div class="success-icon">✅</div>
    <h2>Password Reset Successful!</h2>
    <div class="success-message">
      <p>Your password has been successfully reset.</p>
      <p>You will be automatically redirected to the login page in a few seconds.</p>
    </div>
    
    <div class="action-buttons">
      <button type="button" class="login-btn" (click)="goToLogin()">
        Go to Login Now
      </button>
    </div>
  </div>

  <!-- Token Expired/Invalid -->
  <div *ngIf="tokenExpired" class="error-container">
    <div class="error-icon">⚠️</div>
    <h2>Reset Link Expired</h2>
    <div class="error-message-container">
      <p>This password reset link has expired or is invalid.</p>
      <p>Reset links are only valid for a limited time for security reasons.</p>
    </div>
    
    <div class="action-buttons">
      <button type="button" class="retry-btn" (click)="goToForgotPassword()">
        Request New Reset Link
      </button>
      
      <button type="button" class="login-btn" (click)="goToLogin()">
        Back to Login
      </button>
    </div>
    
    <!-- Error Display for Expired Token -->
    <div *ngIf="error" class="error">{{ error }}</div>
  </div>
</div>
