<div class="post-list-container">
  
  <div class="header">
    <h1>My Posts</h1>
    <button mat-raised-button color="primary" routerLink="/posts/new">
      <mat-icon>add</mat-icon>
      Create Post
    </button>
  </div>

  <mat-card class="filters-card">
    <div class="filters-row">
      <mat-form-field class="search-field">
        <mat-label>Search posts...</mat-label>
        <input matInput 
               [value]="filters.search" 
               (input)="onSearchChange($any($event.target).value)"
               placeholder="Search by title or content">
        <mat-icon matSuffix>search</mat-icon>
      </mat-form-field>

      <mat-form-field class="filter-field">
        <mat-label>Channel</mat-label>
        <mat-select [(value)]="filters.channel" (selectionChange)="onFilterChange()">
          <mat-option *ngFor="let option of channelOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="filter-field">
        <mat-label>Date Range</mat-label>
        <mat-select [(value)]="filters.dateRange" (selectionChange)="onFilterChange()">
          <mat-option *ngFor="let option of dateRangeOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field class="filter-field">
        <mat-label>Sort By</mat-label>
        <mat-select [(value)]="filters.sortBy" (selectionChange)="onFilterChange()">
          <mat-option *ngFor="let option of sortOptions" [value]="option.value">
            {{ option.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </mat-card>

  <mat-tab-group (selectedIndexChange)="onTabChange($event)" class="status-tabs">
    <mat-tab *ngFor="let tab of statusTabs" [label]="tab.label + (tab.count > 0 ? ' (' + tab.count + ')' : '')"></mat-tab>
  </mat-tab-group>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading posts...</p>
  </div>

  <div *ngIf="error && !isLoading" class="error-container">
    <mat-icon>error</mat-icon>
    <p>{{ error }}</p>
    <button mat-button color="primary" (click)="loadPosts()">Try Again</button>
  </div>

  <div *ngIf="!isLoading && !error" class="posts-grid">
    <div *ngIf="posts.length === 0" class="empty-state">
      <mat-icon>post_add</mat-icon>
      <h3>No posts found</h3>
      <p>Get started by creating your first post</p>
      <button mat-raised-button color="primary" routerLink="/posts/new">
        Create Post
      </button>
    </div>

    <mat-card *ngFor="let post of posts" class="post-card">
      <mat-card-header>
        <div mat-card-avatar class="post-avatar">
          <mat-icon>{{ getChannelIcon(post.channel) }}</mat-icon>
        </div>
        <mat-card-title>{{ post.title }}</mat-card-title>
        <mat-card-subtitle>
          <span class="status-chip" [ngClass]="getStatusClass(post.status)">{{ post.status }}</span>
          <span class="post-date">{{ formatDate(post.createdAt) }}</span>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <p class="post-excerpt">{{ (post.body || '') | slice:0:150 }}{{ (post.body || '').length > 150 ? '...' : '' }}</p>
        <div class="post-meta">
          <mat-chip-listbox class="tag-list" *ngIf="post.tags && post.tags.length > 0">
            <mat-chip *ngFor="let tag of post.tags">{{ tag }}</mat-chip>
          </mat-chip-listbox>
          <div class="post-stats">
            <span *ngIf="post.scheduledAt" class="scheduled-time">
              <mat-icon>schedule</mat-icon>
              {{ formatDate(post.scheduledAt) }}
            </span>
          </div>
        </div>
      </mat-card-content>

      <mat-card-actions>
        <button mat-button (click)="onPostAction('view', post.id)">
          <mat-icon>visibility</mat-icon>
          View
        </button>
        <button mat-button (click)="onPostAction('edit', post.id)">
          <mat-icon>edit</mat-icon>
          Edit
        </button>
        <button mat-icon-button [matMenuTriggerFor]="postMenu">
          <mat-icon>more_vert</mat-icon>
        </button>
        <mat-menu #postMenu="matMenu">
          <button mat-menu-item (click)="onPostAction('duplicate', post.id)">
            <mat-icon>content_copy</mat-icon>
            Duplicate
          </button>
          <button mat-menu-item (click)="onPostAction('delete', post.id)" class="delete-action">
            <mat-icon>delete</mat-icon>
            Delete
          </button>
        </mat-menu>
      </mat-card-actions>
    </mat-card>
  </div>

  <div *ngIf="hasMore && !isLoading" class="load-more-container">
    <button mat-raised-button 
            color="accent" 
            (click)="onLoadMore()" 
            [disabled]="isLoadingMore">
      <mat-spinner *ngIf="isLoadingMore" diameter="20"></mat-spinner>
      <span *ngIf="!isLoadingMore">Load More Posts</span>
      <span *ngIf="isLoadingMore">Loading...</span>
    </button>
  </div>

  <div *ngIf="isLoadingMore" class="loading-more">
    <mat-spinner diameter="30"></mat-spinner>
    <p>Loading more posts...</p>
  </div>
</div>